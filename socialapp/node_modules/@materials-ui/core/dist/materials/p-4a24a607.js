var n=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'],t=n.join(","),e="undefined"==typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;function r(n,r){r=r||{};var u,i,f,s=[],d=[],v=n.querySelectorAll(t);for(r.includeContainer&&e.call(n,t)&&(v=Array.prototype.slice.apply(v)).unshift(n),u=0;u<v.length;u++)o(i=v[u])&&(0===(f=c(i))?s.push(i):d.push({documentOrder:u,tabIndex:f,node:i}));return d.sort(a).map((function(n){return n.node})).concat(s)}function o(n){return!(!u(n)||function(n){return function(n){return f(n)&&"radio"===n.type}(n)&&!function(n){if(!n.name)return!0;var t=function(n){for(var t=0;t<n.length;t++)if(n[t].checked)return n[t]}(n.ownerDocument.querySelectorAll('input[type="radio"][name="'+n.name+'"]'));return!t||t===n}(n)}(n)||c(n)<0)}function u(n){return!(n.disabled||function(n){return f(n)&&"hidden"===n.type}(n)||function(n){return null===n.offsetParent||"hidden"===getComputedStyle(n).visibility}(n))}r.isTabbable=function(n){if(!n)throw new Error("No node provided");return!1!==e.call(n,t)&&o(n)},r.isFocusable=function(n){if(!n)throw new Error("No node provided");return!1!==e.call(n,i)&&u(n)};var i=n.concat("iframe").join(",");function c(n){var t=parseInt(n.getAttribute("tabindex"),10);return isNaN(t)?function(n){return"true"===n.contentEditable}(n)?0:n.tabIndex:t}function a(n,t){return n.tabIndex===t.tabIndex?n.documentOrder-t.documentOrder:n.tabIndex-t.tabIndex}function f(n){return"INPUT"===n.tagName}var s,d,v=r,l=Object.prototype.hasOwnProperty,p=(d=[],{activateTrap:function(n){if(d.length>0){var t=d[d.length-1];t!==n&&t.pause()}var e=d.indexOf(n);-1===e?d.push(n):(d.splice(e,1),d.push(n))},deactivateTrap:function(n){var t=d.indexOf(n);-1!==t&&d.splice(t,1),d.length>0&&d[d.length-1].unpause()}});function b(n){return setTimeout(n,0)}var m=function(n,t){var e=document,r="string"==typeof n?e.querySelector(n):n,o=function(){for(var n={},t=0;t<arguments.length;t++){var e=arguments[t];for(var r in e)l.call(e,r)&&(n[r]=e[r])}return n}({returnFocusOnDeactivate:!0,escapeDeactivates:!0},t),u={firstTabbableNode:null,lastTabbableNode:null,nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1},i={activate:function(n){if(!u.active){F(),u.active=!0,u.paused=!1,u.nodeFocusedBeforeActivation=e.activeElement;var t=n&&n.onActivate?n.onActivate:o.onActivate;return t&&t(),a(),i}},deactivate:c,pause:function(){!u.paused&&u.active&&(u.paused=!0,f())},unpause:function(){u.paused&&u.active&&(u.paused=!1,F(),a())}};return i;function c(n){if(u.active){clearTimeout(s),f(),u.active=!1,u.paused=!1,p.deactivateTrap(i);var t=n&&void 0!==n.onDeactivate?n.onDeactivate:o.onDeactivate;return t&&t(),(n&&void 0!==n.returnFocus?n.returnFocus:o.returnFocusOnDeactivate)&&b((function(){var n;N((n=u.nodeFocusedBeforeActivation,d("setReturnFocus")||n))})),i}}function a(){if(u.active)return p.activateTrap(i),s=b((function(){N(m())})),e.addEventListener("focusin",h,!0),e.addEventListener("mousedown",w,{capture:!0,passive:!1}),e.addEventListener("touchstart",w,{capture:!0,passive:!1}),e.addEventListener("click",E,{capture:!0,passive:!1}),e.addEventListener("keydown",y,{capture:!0,passive:!1}),i}function f(){if(u.active)return e.removeEventListener("focusin",h,!0),e.removeEventListener("mousedown",w,!0),e.removeEventListener("touchstart",w,!0),e.removeEventListener("click",E,!0),e.removeEventListener("keydown",y,!0),i}function d(n){var t=o[n],r=t;if(!t)return null;if("string"==typeof t&&!(r=e.querySelector(t)))throw new Error("`"+n+"` refers to no known node");if("function"==typeof t&&!(r=t()))throw new Error("`"+n+"` did not return a node");return r}function m(){var n;if(!(n=null!==d("initialFocus")?d("initialFocus"):r.contains(e.activeElement)?e.activeElement:u.firstTabbableNode||d("fallbackFocus")))throw new Error("Your focus-trap needs to have at least one focusable element");return n}function w(n){r.contains(n.target)||(o.clickOutsideDeactivates?c({returnFocus:!v.isFocusable(n.target)}):o.allowOutsideClick&&o.allowOutsideClick(n)||n.preventDefault())}function h(n){r.contains(n.target)||n.target instanceof Document||(n.stopImmediatePropagation(),N(u.mostRecentlyFocusedNode||m()))}function y(n){if(!1!==o.escapeDeactivates&&function(n){return"Escape"===n.key||"Esc"===n.key||27===n.keyCode}(n))return n.preventDefault(),void c();(function(n){return"Tab"===n.key||9===n.keyCode})(n)&&function(n){if(F(),n.shiftKey&&n.target===u.firstTabbableNode)return n.preventDefault(),void N(u.lastTabbableNode);n.shiftKey||n.target!==u.lastTabbableNode||(n.preventDefault(),N(u.firstTabbableNode))}(n)}function E(n){o.clickOutsideDeactivates||r.contains(n.target)||o.allowOutsideClick&&o.allowOutsideClick(n)||(n.preventDefault(),n.stopImmediatePropagation())}function F(){var n=v(r);u.firstTabbableNode=n[0]||m(),u.lastTabbableNode=n[n.length-1]||m()}function N(n){n!==e.activeElement&&(n&&n.focus?(n.focus(),u.mostRecentlyFocusedNode=n,function(n){return n.tagName&&"input"===n.tagName.toLowerCase()&&"function"==typeof n.select}(n)&&n.select()):N(m()))}};export{m as c};